UE = CS.UnityEngine
-- local util = require 'xlua.util'


pipeSpawnTime = 4
m_pipeSpawnTime = 0
distanceTwoPipes = 7
pipeStartPosX = 6
pipePosMax = 4.5
pipePosMin = 0.8

birdStartPos = -4

bird = nil
bird_rb = nil

gameHasEnded = false


function LuaStart()
    birdPos = GetVector3D(birdStartPos, 0, 0)
    bird = Spawn("Bird", birdPos)

    SpawnPipes()
end

function LuaUpdate()
    m_pipeSpawnTime = m_pipeSpawnTime + UE.Time.deltaTime

    if (m_pipeSpawnTime >= pipeSpawnTime) then      
        --UE.Debug.Log("Đã tới lúc spawn pipe")
        SpawnPipes()
        m_pipeSpawnTime = 0
    end
end


function LuaEndGame()
    if (gameHasEnded == true) then
        return
    end

    print("End Game, gọi từ Lua")
    gameHasEnded = true
    Restart()
end

function Restart()
    print("Restart Game, gọi từ Lua")
    UE.SceneManagement.SceneManager.LoadScene(UE.SceneManagement.SceneManager.GetActiveScene().name)
end




function SpawnPipes()
    pipeUpPos = GetVector3D(pipeStartPosX, UE.Random.Range(pipePosMin, pipePosMax), 0)
    pipeDownPos = pipeUpPos - GetVector3D(0, distanceTwoPipes, 0)

    pipeUp = Spawn("Pipe", pipeUpPos)
    pipeDown = Spawn("Pipe", pipeDownPos)
end

function Spawn(path, pos)
    go = CS.Extensions.LoadPrefab(path)
    local x = UE.Object.Instantiate(go, pos, UE.Quaternion.identity)
    return x
end


function GetVector3D(x, y, z)
    return UE.Vector3(x, y, z)
end

function GetVector2D(x, y)
    return UE.Vector2(x, y)
end



